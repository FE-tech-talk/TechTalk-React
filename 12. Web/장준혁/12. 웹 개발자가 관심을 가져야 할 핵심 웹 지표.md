## 12. 웹 개발자가 관심을 가져야 할 핵심 웹 지표

### 1. 웹 사이트와 성능

사용자가 웹 사이트를 접속했을 때 공통적으로 기대하는 사항에는 첫 번째로 웹사이트를 방문한 목적을 쉽게 달성할 수 있어야 하고 두 번째로 첫 번째 목적을 달성하는 데 걸리는 시간이 짧아야 하며, 마지막으로 웹사이트에서 개인정보가 누출되는 사고 없이 보안이 철저해야 한다.
디지털 마케팅 에이전시 회사인 Protent의 조사에 따르면 1초 내 로딩되는 사이트는 5초 내로 로딩되는 사이트보다 실제 고객 비율이 2.5배 높았으며 0~5초 범위에서, 1초 로딩이 늦어질수록 전환율은 4.42%씩 떨어졌으며 페이지 로드 시간이 0~2초 사이인 페이지에서 가장 높은 전환율을 달성했다.
아무리 화려하고 멋진 웹사이트라 하더라도 방문객의 시간을 희생해야 한다면 무의미하다.
개발자의 기기가 일반적인 사용자가 쓰는 기기보다 훨씬 더 성능이 좋고 네트워크 환경도 안정적이라 성능 문제를 경험하기 힘들다.
또한 성능 개선 작업은 쉽지도, 재밌지도 않고 서비스 개발 작업 대비 눈에 띄는 성능 향상을 기대하기도 어렵다.
몇년 전부터 구글은 핵심 웹 지표(Core Web Vital)라고 하는, 웹사이트의 우수한 사용자 경험을 제공하는 데 필요한 핵심적인 요소를 꼽고 지표를 제시하고 있다.

### 2. 핵심 웹 지표란?

구글에서 만든 지표로, 웹사이트에서 뛰어난 사용자 경험을 제공하는데 필수적인 지표를 일컫는다.

- 최대 콘텐츠풀 페인트 (LCP : Largest Conetentful Patin)
- 최초 입력 지연 (FID : First Input Delay)
- 누적 레이아웃 이동 (CLS : Cumlative Layout Shift)

다음 두 지표는 핵심까지는 아니지만, 특정 문제를 진단하는데 사용 된다.

- 최초 바이트까지의 시간 (TTFB : Time To First Byte)
- 최초 콘텐츠풀 시간 (FCP : First Contentful Paint)

### 3. LCP

최대 콘텐츠풀 페인트란 페이지가 처음으로 로드를 시작한 시점부터 뷰포트 내부에서 가장 큰 이미지 또는 텍스트를 렌더링하는 데 걸리는 시간이다.
각 엘리먼트가 등장한 시점부터 텍스트 또는 이미지가 완전히 로딩되는 시점이다.
최대 콘텐츠풀 페인트에 영향을 미치는 부분은 오직 뷰포트 영역뿐이다.
LCP 등의 각종 지표 점수를 측정하는 방법으로는 먼저 직접 자바스크립트 API를 호출하는 방법과 다른 도구를 활용하는 방법이 있는데 대부분 후자를 택한다.
최대 콘텐츠풀 페인트에서 좋은 점수란 2.5초 내로 응답이 오는 것이다. 4초 이내로 응답이 온다면 보통, 그 이상이 걸리면 나쁨으로 판단된다.

LCP를 높이기 위해서 뷰포트 최대 영역에서 이미지가 아닌 문자열을 넣거나 이미지 무손실 압축, 레이지 로딩 주의, 애니메이션, 클라이언트에서 빌드하지 말 것, lcp 리소스는 직접 호스팅등이 있다.

### 4. FID

아무리 페이지가 빨리 로딩 되더라도 웹사이트와 상호작용을 할 수 없다면 웹사이트가 느리다고 생각할 것이다. 아무리 최초에 페이지가 빨리 그려진들 사용자는 부정적인 경험을 겪게 될 것이다.
최초 입력 지연의 정의는 '사용자가 페이지와 처음 상호 작용할 때부터 해당 상호 작용에 대한 응답으로 브라우저가 실제로 이벤트 핸들러 처리를 시작하기까지의 시간을 측정한다.'이다.

내부 이벤트 반응이 늦어지는 이유는 해당 입력을 처리해야하는 브라우저의 메인 스레드가 바쁘기 때문인데 대규모 렌더링이 일어나거나 대규모 자바스크립트 파일을 분석하고 실행하는 등 다른 작업을 처리하는 데 리소스를 할애하고 있기 떄문이다.
즉, 최대한 메인 스레드가 다른 작업을 처리할수 있도록 여유를 만들어 줘야 사용자에게 빠른 반응성을 보장할 수 있다.

정리하자면, 최초 입력 지연은 화면이 최초에 그려지고 난 뒤, 사용자가 웹페이지에서 클릭 등 상호작용을 수행했을 때 메인 스레드가 이 이벤트에 대한 반응을 할 수 있을 떄까지 걸리는 시간이다.

최초 입력 지연의 좋은 점수를 얻기 위해서는 100ms 이내로 응답이 와야 하며, 300ms 이내인 경우 보통, 그 이후의 경우는 나쁨으로 처리된다.

FID를 개선하기 위해 실행에 오래 걸리는 긴 작업을 분리하거나 자바스크립트 코드를 최소화하고 제3자가 만든 스크립트 코드 실행을 지연할 수 있다.

### 5. CLS

페이지 생명주기 동안 발생하는 모든 예기치 않은 이동에 대한 지표를 계산한 것이다.
최초 렌더링이 시작된 위치에서 레이아웃 이동이 발생한다면 누적 레이아웃 이동 점수로 기록하게 된다. 단순히 요소가 추가된다고 무조건 누적 레이아웃 이동으로 간주되는 것은 아니고 다른 요소의 시작 위치에 영향을 미치지 않았다면 레이아웃 이동으로 간주하지 않는다.
이 점수를 계산할 때 레이아웃 이동이 발생한 요소의 전체 높이와 뷰포트 높이의 비율을 의미하는 영향분율, 레이아웃 이동이 발생한 요소가 뷰포트 대비 얼마나 이동했는지 의미하는 거리분율을 사용한다.
이 두 점수를 곱해 최종 점수를 계산한다.

0.1 이하인 경우 좋음, 0.25 이하인 경우 보통이며 그 외에는 개선이 필요한 나쁜 점수로 보고된다.

삽입이 예상되는 요소를 위한 추가적인 공간을 확보하거나 폰트 로딩을 최적화해야하며 적절한 이미지 크기를 설정해야한다.

- TTFB (최초 바이트까지의 시간) : 브라우저가 웹페이지의 첫 번째 바이트를 수신하는데 걸리는 시간을 의미한다.
- FCP (최초 콘텐츠풀 페인트) : 페이지가 로드되기 시작한 시점부터 페이지 콘텐츠의 일부가 화면에 렌더링될 때까지의 시간이다. 1.8초 이내에 이뤄진다면 좋음, 3.0초 이내는 보통, 그 이후는 개선이 필요한 것으로 본다.
