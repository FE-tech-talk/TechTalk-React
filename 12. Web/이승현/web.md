## 웹사이트와 성능

진입하는데 0~2초가 가장 전환율이 좋고
평균 리소스 요청 수는 50회 미만인 것이 좋다.
평균적으로 웹 페이지 전체를 요청하는데 15.3초가 걸린다.

구글은 Core Web Vital 이라고 하는 핵심 웹 지표를 발표하였다.

## Core Web Vital

### LCP : Largest Contentful Paint (최대 콘텐츠풀 페인트)

페이지가 처음으로 로드를 시작한 시점부터 뷰포트 내부에서 가장 큰 이미지 또는 텍스트를 렌더링하는 데 걸리는 시간

ViewPort : 현재 노출되는 화면

#### 큰 이미지와 텍스트

1. `<img>`
2. `<svg>` 내부의 `<image>`
3. poster 속성을 사용하는 `<video>`
4. url()을 통해 불러온 배경 이미지가 있는 요소
5. 텍스트와 같이 인라인 텍스트 요소를 포함하고 있는 블록 레벨 요소
	1. 이 블록 레벨 요소에는 `<p>`, `<div>` 등이 포함된다.

#### 기준 점수

2.5초 이내로 응답이 오면 좋음, 4초 이내 보통, 그 이상은 나쁨

#### 개선 방안

1. LCP에는 다운로드가 필요한 리소스보다 텍스트 노출로 채우는게 좋다.
2. 이미지 불러오는 법
	1. `<img>`: 프리로드 스캐너에 의해 발견되어 HTML 파싱을 차단하지 않고 병렬 적으로 리소스 다운
	2. `<svg>`: 모든 리소스를 다 불러온 이후에 이미지를 불러옴, 프리로드 스캐너를 사용하지 않기 때문에 사용하지 않는 것이 좋다.
	3. `<video>` 의 poster : poster를 넣으면 프리로드 스캐너, 안 넣으면 실제로 로딩해서 첫번째 프레임을 넣기 때문에 LCP에 좋지 않다.
	4. `background-image` : `url():background-image`를 비롯해서 CSS에 있는 리소스는 항상 느리다. LCP에 관련해서는 중요한 리소스를 사용하지 않는 것이 좋다.

#### 조심할 사항

1. 이미지 무손실 압축
2. loading=lazy : LCP를 중요하지 않은 리소스로 만들 수 있다. 별로 중요하지 않는 이미지에만 사용하자.
3. 각종 애니메이션
4. 클라이언트에서 빌드하지 않는것, 서버에서 빌드해온 html을 프리로드 스캐너가 바로 읽어서 LCP로 가져가는 것이 이상적이다. LCP를 useEffect 같은걸로 로드하면 리액트 코드를 파싱하고 API 요청을 보내고 응답을 받는 만큼 늦어진다.
5. 중요한 리소스, 큰 리소스는 같은 origin에서 다루도록 한다.

### FID : First Input Delay (최초 입력 지연)

#### 정의

웹사이트의 반응 속도, 최초 입력 지연 (First Input Delay)
모든 입력에 대해 측정하는 것이 아니라,, 최초의 입력 하나에 대해서만 응답 지연이 얼마나 걸리는지 판단
#### 의미

##### RAIL

###### Response

사용자의 입력에 대한 반응 속도, 50ms 미만으로 이벤트를 처리할 것

###### Animation

애니메이션의 각 프레임을 10ms 이하로 생성할 것

###### Idle

유휴 시간을 극대화해 페이지가 50ms 이내에 사용자 입력에 응답하도록 할 것 

###### Load

5초 이내에 콘텐츠를 전달하고 인터랙션을 준비할 것

FID는 여기서 R 기반인 것이다.

함수 처리 완료가 아니라 실행을 기준으로 측정한다. Event Timing API을 사용하면 실행 시간을 측정할 수 있다.

#### 기준 점수

좋은 점수 : 100ms 이내
보통 : 300ms 이내
나쁨 : 그 이상

#### 개선 방법

1. 실행에 오래 걸리는 긴 작업 분리 : 메인 스레드를 사용하는 작업을 분리하거나 다른 곳으로 옮겨서 처리 (suspense, lazy 혹은 next의 dynamic)
2. 자바스크립트 코드 최소화 : 개발자 도구 > 도구 더보기 > 커버리지 에서 기록, 새로고침 하면 필요 없는 코드 확인 가능
3. 타사 자바스크립트 코드 실행의 지연 : defer, async 등으로 script의 실행을 지연

### CLS : Cumulative Layout Shift (누적 레이아웃 이동)

#### 의미

초기 렌더링시의 요소의 위치에 영향을 주는 무언가 (useEffect로 컴포넌트 생성) 로 인한 레이아웃 이동을 나타냄.

개발자 도구의 성능에서 해당 내용을 실험할 수 있다.

#### 기준 점수

0.1 , 0.25, 그 이상 으로 나뉜다.

#### 개선 방안

1. 삽입이 예상되는 요소를 위한 추가적인 공간 확보 : useLayoutEffect로 미리 공간 넣기 (동기적으로 작동하기 때문에 로딩이 오래걸리는 것과 같이 보일 수 있, 스켈레톤, 서버사이드 렌더링 (미리 HTML을 제공))
2. 폰트 로딩 최적화
3. 적절한 이미지 크기 설정

### TTFB : Time To First Byte (최초 바이트까지의 시간)



### FCP : First Contentful Paint (최초 콘텐츠풀 시간)