# 5. 이벤트 루프와 비동기 통신의 이해

자바스크립트는 **싱글 스레드**에서 작동하여, 기본적으로 동기 방식 처리

그러나 요청을 시작한 후 다음 작업을 처리하는 `비동기` 작업이 실행될 수 있음

<br>

## 5-1. 싱글 스레드 자바스크립트

자바스크립트가 나왔을 당시, 멀티 스레드에 대한 개념이 대중화❌

⮕ 자바스크립트는 싱글 스레드 = 하나의 스레드에서 순차적으로 실행 = `동기적`

<br>

그러나 `async` 를 사용하여 비동기 함수 선언하여 여러 작업을 동시에 수행⭕️

<br>

## 5-2. 이벤트 루프란?

`이벤트 루프`란?
<br>
자바스크립트 런타임 외부에서 자바스크립트의 비동기 실행을 돕기 위해 만들어진 장치

`태스크 큐`란?
<br>
실행해야 할 태스크의 집합, set 형태

<br>

### 호출 스택과 이벤트 루프

**호출 스택**은 수행해야 할 코드나 함수를 순차적으로 담아두는 스택

#### [소스코드]

```js
function bar() {
  console.log('bar');
}

function baz() {
  console.log('baz');
}

function foo() {
  console.log('foo');
  setTimeout(bar, 0);
  baz();
}

foo();
```

#### [결과]

```
foo
baz
bar
```

#### [동작 방식]

1. foo() 가 호출 스택에 들어감
2. foo() 내부 console.log 가 호출 스택에 들어감
3. 실행 완료 후, setTimeout(bar, 0) 이 호출 스택에 들어감
4. 타이머 이벤트가 실행되어 태스크 큐로 들어가고, 스택에서 제거
5. baz() 가 호출 스택에 들어감
6. baz() 내부 console.log 가 호출 스택에 들어감
7. 실행 완료 후, baz() 와 foo() 가 호출 스택에서 제거
8. 호출 스택 완전히 비워짐
9. 이벤트 루프가 호출 스택이 비워진 걸 확인하고. 태스크 큐를 확인하여 bar() 를 호출 스택에 들어감
10. bar() 내부 console.log 가 호출 스택에 들어감
11. 실행 완료 후, bar() 가 호출 스택에서 제거

<br>

⮕ `이벤트 루프`가 호출 스택에 실행 중인 코드가 있는지, 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인

⮕ 비동기 함수는 메인 스레드가 아닌 `태스크 큐`가 할당하는 별도의 스레드에서 수행

<br>

## 5-3. 태스크 큐와 마이크로 태스크 큐

`마이크로 태스크 큐`란?
<br>
기존 태스크 큐와 다른 태스크를 처리하며 기존 태스크 큐보다 우선권을 갖는 큐, ex) `Promise`

#### [소스 코드]

```js
function foo() {
  console.log('foo');
}

function bar() {
  console.log('bar');
}

setTimeout(foo, 0);

Promise.resolve().then(bar);
```

#### [결과]

```
bar
foo
```

⮕ Promise 가 우선권이 있음

<br>

### 렌더링

마이크로 태스크 큐를 실행하고, 마이크로 태스크 큐를 실행한 뒤 **렌더링** 발생

- `동기코드`: for 문 끝나야 렌더링
- `태스크 큐`: 순차적으로 렌더링
- `마이크로 태스크 큐`: for 문 끝나야 렌더링
