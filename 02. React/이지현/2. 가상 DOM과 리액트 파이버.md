# 2. 가상 DOM과 리액트 파이버

React 에서 `가상 DOM` 을 운영

<br>

## 2-1. DOM과 브라우저 렌더링 과정

`DOM(Document Object Model)`이란?
<br>
웹페이지에 대한 인터페이스로 브라우저가 웹페이지의 콘텐츠와 구조를 어떻게 보여줄지에 대한 정보 담음

### 렌더링 과정

1. 브라우저가 사용자가 요청한 주소를 방문해 HTML 파일 다운로드
2. 브라우저의 렌더링 엔진으 HTML을 파싱해 DOM 노드로 구성된 트리(DOM)를 만듦
3. 2번 과정에서 CSS 파일을 만나면 해당 CSS 파일 다운로드
4. 브라우저와 렌더링 엔진은 이 CSS도 파싱해 CSS 노드로 구성된 트리(CSSDOM)를 만듦
5. 브라우저는 2번에서 만든 DOM에서 눈에 보이는 노드만 순회
6. 해당 노드에 대한 CSSDOM 정보를 찾고 발견한 CSS 스타일 정보를 노드에 적용

<br>

## 2-2. 가상 DOM의 탄생 배경

DOM 변경이 일어나는 요소가 많은 자식 요소를 가지고 있는 경우 하위 자식 요소도 변경돼야 하기 때문에 많은 비용이 요구됨

⮕ 이러한 문제를 해결하기 위해, 웹 페이지가 표시해야 할 DOM을 일단 메모리에 저장하고 React가 실제로 변경에 대해 준비가 완료됐을 때 실제 브라우저의 DOM에 반영하는 `가상 DOM` 탄생

<br>

## 2-3. 가상 DOM을 위한 아키텍처, 리액트 파이버

`리액트 파이버`란?
<br>
가상 DOM과 렌더링 과정 최적화를 가능하게 해주는 것

### 1. 리액트 파이버란? (React Fiber)

**리액트 파이버**는 리액트에서 관리하는 평범한 자바스크립트 객체로, 파이버는 `파이버 재조정자`가 관리함

`파이버 재조정자(fiber reconciler)`가 가상 DOM과 실제 DOM을 비교해 변경 사항을 수집하며,
<br>
만약 둘 사이에 차이가 있으면 변경에 관련된 정보를 가지고 있는 파이버를 기준으로 화면에 렌더링을 요청하는 역할을 함

+) 리액트 파이버는 비동기 작업을 수행함

<br>

### 2. 리액트 파이버 트리

리액트 파이버 트리는 1. 현재 모습을 담은 리액트 트리, 2. 작업 중인 상태를 나타내는 `workInProcess` 트리 이렇게 2개 존재

리액트 파이버의 작업이 끝나면 리액트는 단순히 포인터만 변경해 `workInProcess` 트리를 현재 트리로 바꿈
<br>
⮕ 더블 버퍼링

<br>

### 3. 파이버의 작업 순서

생성된 트리에서 setState 등으로 업데이트 되면,
<br>
이미 만든 current 트리가 존재하고, setState로 인한 업데이트 요청을 받아 `workInProcess` 트리를 다시 빌드

⮕ 이미 파이버가 존재함으로 새로 생성하지 않고 기존 파이버에서 업데이트된 props를 받아 파이버 내부에서 처리

<br>

## 2-4. 파이버와 가상 DOM

실제 브라우저 구조인 DOM에 반영하는 것은 동기적으로 일어남
